{"ast":null,"code":"import { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { of } from 'rxjs';\nimport { MessageService } from '../../messages/message.service';\nimport { FileUploadService } from '../../products/shared/file-upload.service';\nimport { ProductService } from '../../products/shared/product.service';\nimport { ProductsCacheService } from '../../products/shared/products-cache.service';\nimport { Product } from '../../models/product.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../products/shared/product.service\";\nimport * as i3 from \"../../products/shared/file-upload.service\";\nimport * as i4 from \"../../products/shared/products-cache.service\";\nimport * as i5 from \"../../messages/message.service\";\nimport * as i6 from \"../../core/page-title/page-title.component\";\nimport * as i7 from \"@angular/forms\";\nimport * as i8 from \"@angular/common\";\nconst _c0 = [\"photos\"];\n\nfunction AddEditComponent_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 30);\n    i0.ɵɵtext(1, \" Shucks, enter a name for your product. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AddEditComponent_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 30);\n    i0.ɵɵtext(1, \" Shucks, enter a number as id for your product. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AddEditComponent_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 30);\n    i0.ɵɵtext(1, \" Shucks, enter a date for your product. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AddEditComponent_div_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 30);\n    i0.ɵɵtext(1, \" Shucks, enter at least one category for your product. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AddEditComponent_div_37_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 30);\n    i0.ɵɵtext(1, \" Shucks, enter a description for your product. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AddEditComponent_div_49_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 30);\n    i0.ɵɵtext(1, \" Shucks, enter a price for your product. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AddEditComponent_div_55_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 30);\n    i0.ɵɵtext(1, \" Shucks, enter a base price for your product. \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AddEditComponent_div_56_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 31)(1, \"div\", 32);\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"number\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const pct_r9 = ctx.ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵstyleProp(\"width\", pct_r9, \"%\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind2(3, 3, pct_r9, \"1.0-0\"), \"%\");\n  }\n}\n\nconst _c1 = function () {\n  return {\n    title: \"Add/Edit Product\"\n  };\n};\n\nconst _c2 = function (a0) {\n  return [a0];\n}; // we send and receive categories as {key:true},\n// but for the input field we need\n// a product with categories of type string\n\n\nexport class DomainProduct extends Product {}\nexport let AddEditComponent = /*#__PURE__*/(() => {\n  class AddEditComponent {\n    constructor(router, route, productService, fileUploadService, productsCacheService, log) {\n      this.router = router;\n      this.route = route;\n      this.productService = productService;\n      this.fileUploadService = fileUploadService;\n      this.productsCacheService = productsCacheService;\n      this.log = log;\n    }\n\n    ngOnInit() {\n      this.setProduct();\n    }\n\n    initForm() {\n      this.productForm = new FormGroup({\n        name: new FormControl(this.product && this.product.name, Validators.required),\n        id: new FormControl({\n          value: this.product && this.product.id,\n          disabled: true\n        }, [Validators.required, Validators.min(0)]),\n        date: new FormControl(this.product && this.product.date, Validators.required),\n        categories: new FormControl(this.product && this.product.categories, Validators.required),\n        description: new FormControl(this.product && this.product.description, Validators.required),\n        price: new FormControl(this.product && this.product.price, [Validators.required, Validators.min(0)]),\n        priceNormal: new FormControl(this.product && this.product.priceNormal, [Validators.required, Validators.min(0)])\n      });\n      this.onFormChanges();\n    }\n\n    setProduct() {\n      this.route.params.subscribe(params => {\n        this.id = +this.route.snapshot.paramMap.get('id'); // if we have an id, we're in edit mode\n\n        if (this.id) {\n          this.mode = 'edit';\n          this.getProduct(this.id);\n          this.initForm();\n        } else {\n          // else we are in add mode\n          this.mode = 'add';\n          this.constructProduct();\n          this.initForm();\n        }\n      });\n    }\n\n    constructProduct() {\n      const product = this.constructMockProduct();\n      product.categories = this.categoriesFromObjectToString(product.categories);\n      this.syncProduct(product);\n      this.initForm();\n    }\n\n    getProduct(id) {\n      this.productSubscription = this.productService.getProduct(id).subscribe(product => {\n        if (product) {\n          product.categories = this.categoriesFromObjectToString(product.categories);\n          this.syncProduct(product);\n          this.initForm();\n        }\n      });\n    }\n\n    onFormChanges() {\n      this.formSubscription = this.productForm.valueChanges.subscribe(formFieldValues => {\n        const product = Object.assign(Object.assign({}, this.product), formFieldValues);\n        this.syncProduct(product);\n      });\n    }\n\n    syncProduct(product) {\n      const id = this.createId(product);\n      const imageURLs = this.handleImageURLs(product);\n      const reduction = this.calculateReduction(product.priceNormal, product.price);\n      const sale = this.checkForSale(reduction);\n      this.product = Object.assign(Object.assign({}, product), {\n        sale,\n        reduction,\n        id,\n        imageURLs\n      });\n    }\n\n    onSubmit() {\n      this.syncProduct(Object.assign(Object.assign({}, this.product), this.productForm.value));\n      const productToSubmit = this.constructProductToSubmit(this.product);\n      const files = this.photos.nativeElement.files;\n\n      if (this.mode === 'add' && files.length > 0) {\n        this.addProduct(productToSubmit, files);\n      } else if (this.mode === 'edit') {\n        this.updateProduct(productToSubmit, files);\n      } else {\n        this.log.addError('Please provide a file for your product');\n        return;\n      }\n    }\n\n    addProduct(product, files) {\n      this.productService.addProduct({\n        product,\n        files\n      }).subscribe(savedProduct => {\n        if (savedProduct.id) {\n          this.product = null;\n          this.router.navigate(['/products']);\n        }\n      }, error => {\n        this.log.addError('Could not upload your product');\n        return of(error);\n      });\n    }\n\n    updateProduct(product, files) {\n      this.productSubscription.unsubscribe();\n      this.productService.updateProduct({\n        product,\n        files\n      }).subscribe(response => {\n        this.router.navigate(['/products/' + response.id]);\n      }, error => this.log.addError('Could not update your product'));\n    }\n\n    onDelete() {\n      if (this.mode === 'edit') {\n        this.productSubscription.unsubscribe();\n        this.productService.deleteProduct(this.product).then(res => {\n          this.router.navigate(['/products']);\n        });\n      } else {\n        this.log.addError(`Cannot delete new product`);\n      }\n    } // pure helper functions start here:\n\n\n    constructMockProduct() {\n      return new Product();\n    }\n\n    constructProductToSubmit(product) {\n      return Object.assign(Object.assign({}, product), {\n        categories: this.categoriesFromStringToObject(product.categories)\n      });\n    }\n\n    createId(product) {\n      const randomId = Math.floor(Math.random() * new Date().getTime());\n      let id = product.id || randomId;\n\n      if (id === 1) {\n        id = randomId;\n      }\n\n      return id;\n    }\n\n    categoriesFromObjectToString(categories) {\n      // categories: { key: true, key: true} || {}\n      if (Object.keys(categories).length === 0) {\n        return 'example, category';\n      }\n\n      return Object.keys(categories).reduce((result, currentProduct, index, inputArray) => {\n        if (index < inputArray.length - 1) {\n          return result + currentProduct + ',';\n        }\n\n        return result + currentProduct;\n      }, '');\n    }\n\n    categoriesFromStringToObject(categories) {\n      // categories: 'cat1, cat2, cat3' || ''\n      if (categories.length === 0) {\n        return {};\n      }\n\n      return categories.split(',').reduce((combinedCategories, currentCategory) => {\n        combinedCategories[currentCategory.trim()] = true;\n        return combinedCategories;\n      }, {});\n    }\n\n    checkForSale(reduction) {\n      return reduction > 0;\n    }\n\n    calculateReduction(priceNormal, price) {\n      const reduction = Math.round((priceNormal - price) / priceNormal * 100);\n      return reduction > 0 ? reduction : 0;\n    }\n\n    handleImageURLs(product) {\n      if (product.imageURLs && product.imageURLs.length > 0) {\n        return product.imageURLs;\n      }\n\n      return [];\n    }\n\n    ngOnDestroy() {\n      this.formSubscription.unsubscribe();\n    }\n\n  }\n\n  AddEditComponent.ɵfac = function AddEditComponent_Factory(t) {\n    return new (t || AddEditComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.ProductService), i0.ɵɵdirectiveInject(i3.FileUploadService), i0.ɵɵdirectiveInject(i4.ProductsCacheService), i0.ɵɵdirectiveInject(i5.MessageService));\n  };\n\n  AddEditComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AddEditComponent,\n    selectors: [[\"app-add-edit\"]],\n    viewQuery: function AddEditComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 7);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.photos = _t.first);\n      }\n    },\n    decls: 64,\n    vars: 17,\n    consts: [[\"title\", \"Add/Edit Product\", 3, \"children\"], [1, \"container\"], [1, \"row\", \"mb-5\"], [1, \"col-lg-8\"], [1, \"margin-bottom-1x\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"form-group\", \"row\"], [\"for\", \"name\", 1, \"col-2\", \"col-form-label\"], [1, \"col-10\"], [\"formControlName\", \"name\", \"type\", \"text\", \"id\", \"name\", \"value\", \"\", 1, \"form-control\", \"form-control-square\", \"form-control-sm\"], [\"class\", \"form-control-feedback\", 4, \"ngIf\"], [\"for\", \"id\", 1, \"col-2\", \"col-form-label\"], [\"formControlName\", \"id\", \"type\", \"number\", \"id\", \"id\", \"value\", \"0\", 1, \"form-control\", \"form-control-square\", \"form-control-sm\"], [\"for\", \"date-input\", 1, \"col-2\", \"col-form-label\"], [\"type\", \"date\", \"id\", \"date-input\", \"formControlName\", \"date\", \"value\", \"\", 1, \"form-control\"], [\"for\", \"categories\", 1, \"col-2\", \"col-form-label\"], [\"formControlName\", \"categories\", \"type\", \"text\", \"id\", \"categories\", \"value\", \"\", 1, \"form-control\", \"form-control-square\", \"form-control-sm\"], [\"for\", \"description\", 1, \"col-2\", \"col-form-label\"], [\"formControlName\", \"description\", \"id\", \"description\", \"rows\", \"5\", 1, \"form-control\", \"form-control-square\", \"form-control-sm\"], [\"for\", \"photos\", 1, \"col-2\", \"col-form-label\"], [\"type\", \"file\", \"id\", \"photos\", 1, \"\"], [\"photos\", \"\"], [\"for\", \"price\", 1, \"col-2\", \"col-form-label\"], [\"formControlName\", \"price\", \"type\", \"number\", \"id\", \"price\", \"value\", \"\", 1, \"form-control\", \"form-control-square\", \"form-control-sm\"], [\"for\", \"price-normal\", 1, \"col-2\", \"col-form-label\"], [\"formControlName\", \"priceNormal\", \"type\", \"number\", \"id\", \"price-normal\", \"value\", \"0\", 1, \"form-control\", \"form-control-square\", \"form-control-sm\"], [\"class\", \"progress margin-bottom-1x\", 4, \"ngIf\"], [1, \"col\", \"text-right\"], [\"type\", \"button\", 1, \"btn\", \"btn-danger\", 3, \"disabled\", \"click\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", 3, \"disabled\"], [1, \"form-control-feedback\"], [1, \"progress\", \"margin-bottom-1x\"], [\"role\", \"progressbar\", \"aria-valuenow\", \"pct | number: '1.0-0'\", \"aria-valuemin\", \"0\", \"aria-valuemax\", \"100\", 1, \"progress-bar\"]],\n    template: function AddEditComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"app-page-title\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"h2\", 4);\n        i0.ɵɵtext(5, \"Add/Edit Product\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"form\", 5);\n        i0.ɵɵlistener(\"ngSubmit\", function AddEditComponent_Template_form_ngSubmit_6_listener() {\n          return ctx.onSubmit();\n        });\n        i0.ɵɵelementStart(7, \"div\", 6)(8, \"label\", 7);\n        i0.ɵɵtext(9, \"Product Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"div\", 8);\n        i0.ɵɵelement(11, \"input\", 9);\n        i0.ɵɵtemplate(12, AddEditComponent_div_12_Template, 2, 0, \"div\", 10);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(13, \"div\", 6)(14, \"label\", 11);\n        i0.ɵɵtext(15, \"Id\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"div\", 8);\n        i0.ɵɵelement(17, \"input\", 12);\n        i0.ɵɵtemplate(18, AddEditComponent_div_18_Template, 2, 0, \"div\", 10);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(19, \"div\", 6)(20, \"label\", 13);\n        i0.ɵɵtext(21, \"Creation Date\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(22, \"div\", 8);\n        i0.ɵɵelement(23, \"input\", 14);\n        i0.ɵɵtemplate(24, AddEditComponent_div_24_Template, 2, 0, \"div\", 10);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(25, \"div\", 6)(26, \"label\", 15);\n        i0.ɵɵtext(27, \"Categories (commma seperated)\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(28, \"div\", 8);\n        i0.ɵɵelement(29, \"input\", 16);\n        i0.ɵɵtemplate(30, AddEditComponent_div_30_Template, 2, 0, \"div\", 10);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(31, \"div\", 6)(32, \"label\", 17);\n        i0.ɵɵtext(33, \"Product description\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(34, \"div\", 8)(35, \"textarea\", 18);\n        i0.ɵɵtext(36, \"            \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(37, AddEditComponent_div_37_Template, 2, 0, \"div\", 10);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(38, \"div\", 6)(39, \"label\", 19);\n        i0.ɵɵtext(40, \"Add Image\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(41, \"div\", 8);\n        i0.ɵɵelement(42, \"input\", 20, 21);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(44, \"div\", 6)(45, \"label\", 22);\n        i0.ɵɵtext(46, \"Actual Price\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(47, \"div\", 8);\n        i0.ɵɵelement(48, \"input\", 23);\n        i0.ɵɵtemplate(49, AddEditComponent_div_49_Template, 2, 0, \"div\", 10);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(50, \"div\", 6)(51, \"label\", 24);\n        i0.ɵɵtext(52, \"Original Price\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(53, \"div\", 8);\n        i0.ɵɵelement(54, \"input\", 25);\n        i0.ɵɵtemplate(55, AddEditComponent_div_55_Template, 2, 0, \"div\", 10);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(56, AddEditComponent_div_56_Template, 4, 6, \"div\", 26);\n        i0.ɵɵpipe(57, \"async\");\n        i0.ɵɵelementStart(58, \"div\", 2)(59, \"div\", 27)(60, \"button\", 28);\n        i0.ɵɵlistener(\"click\", function AddEditComponent_Template_button_click_60_listener() {\n          return ctx.onDelete();\n        });\n        i0.ɵɵtext(61, \"Delete Product\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(62, \"button\", 29);\n        i0.ɵɵtext(63, \"Save Changes\");\n        i0.ɵɵelementEnd()()()()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"children\", i0.ɵɵpureFunction1(15, _c2, i0.ɵɵpureFunction0(14, _c1)));\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"formGroup\", ctx.productForm);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngIf\", !ctx.productForm.get(\"name\").valid && ctx.productForm.get(\"name\").touched);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngIf\", !ctx.productForm.get(\"id\").valid && ctx.productForm.get(\"id\").touched);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngIf\", !ctx.productForm.get(\"date\").valid && ctx.productForm.get(\"date\").touched);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngIf\", !ctx.productForm.get(\"categories\").valid && ctx.productForm.get(\"categories\").touched);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngIf\", !ctx.productForm.get(\"description\").valid && ctx.productForm.get(\"description\").touched);\n        i0.ɵɵadvance(12);\n        i0.ɵɵproperty(\"ngIf\", !ctx.productForm.get(\"price\").valid && ctx.productForm.get(\"price\").touched);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngIf\", !ctx.productForm.get(\"priceNormal\").valid && ctx.productForm.get(\"priceNormal\").touched);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(57, 12, ctx.fileUploadService.percentage$));\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"disabled\", ctx.mode === \"add\");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"disabled\", ctx.productForm.invalid);\n      }\n    },\n    directives: [i6.PageTitleComponent, i7.ɵNgNoValidate, i7.NgControlStatusGroup, i7.FormGroupDirective, i7.DefaultValueAccessor, i7.NgControlStatus, i7.FormControlName, i8.NgIf, i7.NumberValueAccessor],\n    pipes: [i8.AsyncPipe, i8.DecimalPipe],\n    styles: [\".progress[_ngcontent-%COMP%]{height:auto;border-radius:9px;background-color:#f0f0f0;font-size:13px;font-weight:500;line-height:18px}.progress-bar[_ngcontent-%COMP%]{height:18px;background-color:#0da9ef}\"]\n  });\n  return AddEditComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}